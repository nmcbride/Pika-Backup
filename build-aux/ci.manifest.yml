--- 
app-id: org.gnome.gitlab.sophie_h.PikaBackup
build-options: 
  append-path: /usr/lib/sdk/rust-stable/bin
  build-args: 
    - "--share=network"
  env: 
    CARGO_HOME: /run/build/rust-flatpak/cargo
    RUSTFLAGS: "--remap-path-prefix =../"
command: pika-backup
finish-args: 
  - --filesystem=host
  - --share=network
  - --socket=wayland
  # X11
  - --share=ipc
  - --socket=x11
  - --socket=fallback-x11
  # SSH-keys etc
  - --socket=ssh-auth
  # secrete service (keyring)
  - --talk-name=org.freedesktop.secrets
  # gio::Device etc
  - --talk-name=org.gtk.vfs.*
  # fusermount
  - --device=all
  - --talk-name=org.freedesktop.Flatpak.*
modules: 
  - name: fusermout
    config-opts:
      - MOUNT_FUSE_PATH=/app/bin
    post-install:
      - install fusermount-wrapper.sh /app/bin/fusermount
    sources:
      - type: archive
        url: "https://github.com/libfuse/libfuse/releases/download/fuse-2.9.9/fuse-2.9.9.tar.gz"
        sha256: d0e69d5d608cc22ff4843791ad097f554dd32540ddc9bed7638cc6fea7c1b4b5
      -         
        type: "file"
        path: "fusermount-wrapper.sh"

  - name: borg
    buildsystem: simple
    build-commands: 
      - install borg /app/bin/borg
    sources: 
      - dest-filename: borg
        type: file
        url: "https://github.com/borgbackup/borg/releases/download/1.1.13/borg-linux64"
        sha256: 60a662bef3669ed16bb29dadf6b59b74ff664f983d5fa71de7f1fb05a4fec7c0

  - name: pika-backup
    buildsystem: meson
    sources: 
       - path: ../
         type: dir
        
runtime: org.gnome.Platform
runtime-version: "3.36"
sdk: org.gnome.Sdk
sdk-extensions: 
  - org.freedesktop.Sdk.Extension.rust-stable

